import Head from "next/head";
import Image from "next/image";
import styles from "../styles/Home.module.scss";
import Hero from "../components/hero/Hero";
import gsap from "gsap";
import { useRef } from "react";
// import { ScrollTrigger } from "gsap/ScrollTrigger";
import { ScrollTrigger } from "gsap/dist/ScrollTrigger";
import useIsomorphicLayoutEffect from "../anim/useIsomorphicLayoutEffect";

import animBox from "../anim/animBox";

gsap.registerPlugin(ScrollTrigger);

export default function Home() {
  // ScrollTrigger.defaults({
  //   toggleActions: "restart pause pause pause",

  // });

  const cardWrapper = useRef(null);

  // parallax

  const para_background = useRef(null);
  const para_content = useRef(null);

  const stagger_container = useRef(null);

  // console.log("cardWrapper: ", cardWrapper.current);

  useIsomorphicLayoutEffect(() => {
    const boxes = stagger_container.current.children;

    const boxesArray = Array.from(boxes);

    const elements = cardWrapper.current.children;

    const cards = Array.from(elements);

    let tl = gsap.timeline({
      defaults: { duration: 2, ease: "power3.inOut" },

      scrollTrigger: {
        trigger: "#para_section",
        start: "top 30%",
        end: "bottom bottom",
        scrub: true,
      },
    });

    tl.to(para_background.current, { clipPath: "circle(100% at 50% 50%)" });

    ScrollTrigger.defaults({
      toggleActions: "restart pause pause pause",
    });

    //cards

    cards.forEach((card) => {
      gsap.fromTo(
        card,

        { y: "+=100", opacity: 0 },

        {
          y: 0,
          opacity: 1,
          // stagger: { amount: 0.5 },

          scrollTrigger: {
            trigger: "#section1",
            start: "top 40%",

            end: "bottom, 20%",

            scrub: true,
          },
        }
      );
    });

    //paralax

    para_background.current.style.backgroundPosition = `50% ${
      -innerHeight / 2
    }px`;

    gsap.to(
      para_background.current,

      {
        backgroundPosition: `50% ${innerHeight / 3.5}px`,
        ease: "none",

        scrollTrigger: {
          trigger: "#para_section",
          // start: "top top",
          end: "bottom top",
          scrub: true,
        },
      }
    );

    //boxes

    animBox();
  }, []);

  return (
    // <body data-barba="wrapper">
    <>
      <Head>
        <title>Custom Next.js starter</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <Hero />

      <section className={styles.section_grey50} id="section1">
        <div className="container">
          <h1>First Section</h1>
          <div className={styles.testGrid} ref={cardWrapper}>
            <div className={styles.card}>
              <h2>Test</h2>
              <p>
                Lorem ipsum dolor sit amet consectetur adipisicing elit.
                Adipisci excepturi, recusandae illo rerum perspiciatis omnis.
              </p>
            </div>
            <div className={styles.card}>
              <h2>Test</h2>
              <p>
                Lorem ipsum dolor sit amet consectetur adipisicing elit.
                Adipisci excepturi, recusandae illo rerum perspiciatis omnis.
              </p>
            </div>
            <div className={styles.card}>
              <h2>Test</h2>
              <p>
                Lorem ipsum dolor sit amet consectetur adipisicing elit.
                Adipisci excepturi, recusandae illo rerum perspiciatis omnis.
              </p>
            </div>
          </div>
        </div>
      </section>

      {/* section 2 */}

      <section className={styles.section_grey100} id="section2">
        <div className="container">
          <h1>Second Section</h1>
          <p>
            Lorem ipsum dolor, sit amet consectetur adipisicing elit. Nulla
            fugiat, voluptatum impedit voluptatem libero assumenda animi harum
            distinctio eligendi officia. Nulla natus illo velit eum, itaque
            accusamus nihil? Ipsa, nisi?
          </p>
        </div>
      </section>
      <section className={styles.section_stagger} id="section3">
        <div className={styles.stagger_container} ref={stagger_container}>
          <div className={`${styles.s_box} ${"animBox"}`}></div>
          <div className={`${styles.s_box} ${"animBox"}`}></div>
          <div className={`${styles.s_box} ${"animBox"}`}></div>
          <div className={`${styles.s_box} ${"animBox"}`}></div>
          <div className={`${styles.s_box} ${"animBox"}`}></div>
          <div className={`${styles.s_box} ${"animBox"}`}></div>
          <div className={`${styles.s_box} ${"animBox"}`}></div>
          <div className={`${styles.s_box} ${"animBox"}`}></div>
          <div className={`${styles.s_box} ${"animBox"}`}></div>
          <div className={`${styles.s_box} ${"animBox"}`}></div>
          <div className={`${styles.s_box} ${"animBox"}`}></div>
          <div className={`${styles.s_box} ${"animBox"}`}></div>
        </div>
      </section>

      {/* section parallax */}

      <section className={styles.section_parallax} id="para_section">
        <div className={styles.background} ref={para_background}></div>

        <div className={styles.parallax_container} ref={para_content}>
          <div>
            <h1>Parallax test</h1>
            <p>
              Lorem ipsum dolor sit, amet consectetur adipisicing elit. Aperiam
              accusamus blanditiis, voluptates dolor dicta eaque voluptatem
              totam quas eveniet tenetur eos, excepturi officia. Esse, sapiente
              perferendis tempora quidem nam iusto?
            </p>
          </div>
        </div>
      </section>
    </>
  );
}
